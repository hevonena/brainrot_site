/* ================================
   Font Faces
   ================================ */
@font-face {
  font-family: 'Ruder';
  src: url('/font/RuderPlakatLL-Regular.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Unica';
  src: url('/font/Unica77LL-Regular.otf') format('opentype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Unica';
  src: url('/font/Unica77LL-Bold.otf') format('opentype');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Cornbread';
  src: url('/font/CornbreadTrialUnlicensed-Bold.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

/* ================================
   CSS Variables - Design System
   ================================ */
:root {
  /* Colors */
  --color-background: #ffffff;

  /* Trail Effect */
  --trail-size: 12px;
  --trail-color: rgba(255, 255, 255, 0.4);
  --trail-duration: 0.6s;

  /* Typography */
  --font-family: 'Unica', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-display: 'Ruder', Impact, 'Arial Black', sans-serif;
  --font-bubble: 'Cornbread', cursive;

  /* Container Design - Frosted Glass */
  --container-padding-outer: 48px;
  --container-padding-inner: 24px;
  --container-gap: 48px;
  --container-border-radius: 16px;
  --container-bg: rgba(255, 255, 255, 0.75);
  --container-backdrop-blur: 20px;
}

/* ================================
   Base Styles
   ================================ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-family);
  background: var(--color-background);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  touch-action: none;
  position: relative;
}

/* ================================
   Video Background Layer (Fixed) - Hidden, using scrolling videos instead
   ================================ */
.video-background-layer {
  display: none;
}

/* ================================
   App Container
   ================================ */
#app {
  width: 100%;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  z-index: 1;
}

/* ================================
   Interaction Area
   Note: This is an invisible fullscreen area that
   ScrollNavigator/CircularNavigator attaches to for gesture tracking.
   Must be on top of all other elements to capture scroll/touch events.
   Uses position: fixed to escape parent stacking context.
   No visual styling - only functional.
   ================================ */
.interaction-area {
  width: 100%;
  height: 100%;
  position: fixed;
  top: 0;
  left: 0;
  cursor: grab;
  z-index: 9999;
  pointer-events: auto;
}

.interaction-area:active {
  cursor: grabbing;
}

/* ================================
   Trail Effect
   Note: This is the ONLY UI element directly controlled
   by CircularNavigator (when showTrail option is enabled).
   ================================ */
.rotation-trail {
  position: absolute;
  width: var(--trail-size);
  height: var(--trail-size);
  background: var(--trail-color);
  border-radius: 50%;
  pointer-events: none;
  animation: fadeOut var(--trail-duration) ease-out forwards;
  z-index: 1000;
}

/* ================================
   Animations
   ================================ */
@keyframes fadeOut {
  to {
    opacity: 0;
    transform: scale(0.5);
  }
}

/* ================================
   Milestone Celebration
   ================================ */

/* Fullscreen overlay container */
.milestone-celebration {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10000; /* Above interaction-area (9999) */
  pointer-events: none;
}

.milestone-celebration.active {
  display: flex;
}

/* Bubble wrapper - handles the smash animation */
.milestone-bubble {
  position: relative;
  width: 80vmin;
  height: 80vmin;
  max-width: 600px;
  max-height: 600px;
  transform: scale(0) rotate(-15deg);
  opacity: 0;
}

/* Smash animation when active */
.milestone-celebration.active .milestone-bubble {
  animation: bubble-smash 3.5s ease-out forwards;
}

@keyframes bubble-smash {
  0% {
    transform: scale(0) rotate(-20deg);
    opacity: 0;
  }
  /* Quick smash in */
  15% {
    transform: scale(1.15) rotate(5deg);
    opacity: 1;
  }
  /* Bounce back */
  25% {
    transform: scale(0.95) rotate(-3deg);
    opacity: 1;
  }
  /* Settle with slight wobble */
  35% {
    transform: scale(1.02) rotate(1deg);
    opacity: 1;
  }
  40% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
  /* Hold visible */
  75% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
  /* Fade out */
  100% {
    transform: scale(0.9) rotate(5deg);
    opacity: 0;
  }
}

/* Bubble image (spiky explosion background) */
.bubble-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
  position: absolute;
  top: 0;
  left: 0;
}

/* Text content positioned inside the bubble */
.bubble-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 70%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

/* Large milestone distance */
.milestone-distance {
  font-size: clamp(3rem, 12vmin, 6rem);
  font-weight: 900;
  color: #FFDD00;
  line-height: 1;
  text-transform: uppercase;
  letter-spacing: -2px;
  font-family: var(--font-bubble);
  /* Black outline */
  -webkit-text-stroke: 4px #000;
  paint-order: stroke fill;
}

/* Self-deprecating exclamation */
.milestone-exclamation {
  font-size: clamp(0.9rem, 3vmin, 1.4rem);
  font-weight: 600;
  color: #FFDD00;
  line-height: 1.3;
  max-width: 90%;
  font-family: var(--font-bubble);
  /* Black outline */
  -webkit-text-stroke: 2px #000;
  paint-order: stroke fill;
}

/* Mobile adjustments for milestone */
@media (max-width: 600px) {
  .milestone-bubble {
    width: 90vmin;
    height: 90vmin;
  }

  .bubble-content {
    width: 65%;
  }

  .milestone-distance {
    font-size: clamp(2.5rem, 15vmin, 4rem);
  }

  .milestone-exclamation {
    font-size: clamp(0.8rem, 4vmin, 1.1rem);
  }
}

/* ================================
   Confetti Particles (GPU-accelerated)
   ================================ */
.confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9998; /* Behind milestone-celebration (10000) */
  overflow: hidden;
}

.confetti-particle {
  position: absolute;
  font-size: 32px;
  line-height: 1;
  text-align: center;
  will-change: transform, opacity;
  pointer-events: none;
  user-select: none;
  /* GPU layer promotion */
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* ================================
   Gen-Z Image with Comment Overlay
   Social Media Comment Style
   ================================ */

/* Desktop: Split screen layout with frosted glass container */
.genz-item {
  /* Layout */
  display: flex;
  flex-direction: row;
  align-items: center;
  position: relative;
  box-sizing: border-box;

  /* Container sizing */
  max-width: 1400px;

  /* Inner padding */
  padding: var(--container-padding-inner);

  /* Frosted glass effect */
  background: var(--container-bg);
  backdrop-filter: blur(var(--container-backdrop-blur));
  -webkit-backdrop-filter: blur(var(--container-backdrop-blur));
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: var(--container-border-radius);

  /* Shadows for depth */
  box-shadow:
    0 4px 30px rgba(0, 0, 0, 0.1),
    0 1px 3px rgba(0, 0, 0, 0.05);

  /* Prevent content overflow */
  overflow: hidden;
}

/* Container for the image with text overlay */
.genz-image-container {
  position: relative;
  width: 55%;
  flex-shrink: 0;
  overflow: hidden;
  border-radius: calc(var(--container-border-radius) - 8px);
}

.genz-image-container > img,
.genz-image-container > video {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;
  border-radius: calc(var(--container-border-radius) - 8px);
}

/* Gen-Z Text Overlay - centered on image with parallax */
.genz-text-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 85%;
  text-align: center;
  font-family: var(--font-display);
  font-size: clamp(1.8rem, 4vw, 3.5rem);
  font-weight: 900;
  letter-spacing: 0.05em;
  color: white;
  text-shadow:
    -3px -3px 0 #000,
    3px -3px 0 #000,
    -3px 3px 0 #000,
    3px 3px 0 #000,
    0 0 15px rgba(0,0,0,0.6);
  line-height: 1.25;
  pointer-events: none;
  z-index: 10;
  will-change: transform;
  text-transform: lowercase;
}

.genz-overlay {
  width: 45%;
  min-width: 45%;
  background: transparent; /* Transparent since parent has frosted glass */
  color: #000000;
  display: flex;
  flex-direction: column;
  font-family: var(--font-family);
  padding-left: 12px;
  /* Ensure overlay fills height */
  align-self: stretch;
}

/* Header section */
.genz-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 32px 24px 32px 0;
  flex-shrink: 0;
}

.genz-header .username {
  font-size: 2.2rem;
  font-weight: 700;
  color: #000;
}

/* Divider line */
.genz-divider {
  height: 1px;
  background: #e0e0e0;
  margin: 0;
  flex-shrink: 0;
}

/* Comments section */
.genz-comments {
  flex: 1;
  padding: 24px 24px 24px 0;
  display: flex;
  flex-direction: column;
  gap: 20px;
  overflow-y: auto;
  min-height: 0; /* Allow shrinking */
}

.genz-comment {
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.genz-comment .comment-text {
  font-size: 2.2rem;
  line-height: 1.25;
  color: #000;
  font-weight: 400;
}

.genz-comment .mention {
  font-weight: 700;
  color: #000;
}

/* Avatar images */
img.avatar {
  width: 44px;
  height: 44px;
  min-width: 44px;
  max-width: 44px;
  max-height: 44px;
  border-radius: 50%;
  display: inline-block;
  flex-shrink: 0;
  object-fit: cover;
}

/* Footer section */
.genz-footer {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 32px 36px;
  border-top: 1px solid #e0e0e0;
  margin-top: auto;
  flex-shrink: 0;
}

.genz-footer .add-comment {
  font-size: 2.2rem;
  color: #888;
  font-weight: 400;
}

/* Mobile: Stacked layout with header on top of image */
@media (max-width: 768px) {
  /* Mobile container adjustments */
  :root {
    --container-padding-outer: 16px;
    --container-padding-inner: 16px;
    --container-gap: 32px;
    --container-border-radius: 12px;
  }

  .genz-item {
    flex-direction: column;
  }

  .infinite-scroll-item.genz-item {
    width: calc(100% - var(--container-padding-outer) * 2) !important;
    left: var(--container-padding-outer);
  }

  .genz-image-container {
    width: 100%;
    order: 2; /* Image comes after header */
    border-radius: calc(var(--container-border-radius) - 6px);
  }

  .genz-image-container > img,
  .genz-image-container > video {
    border-radius: calc(var(--container-border-radius) - 6px);
  }

  .genz-text-overlay {
    font-size: clamp(1.2rem, 5vw, 2rem);
  }

  .genz-overlay {
    width: 100%;
    min-width: 100%;
    min-height: auto;
    padding-left: 0;
    padding-top: var(--container-padding-inner);
    display: contents; /* Let children flow in parent flex */
  }

  /* Header on top of image */
  .genz-header {
    order: 1;
    padding: 12px 12px 12px 0;
    gap: 8px;
    background: transparent;
  }

  /* Comments below image */
  .genz-comments {
    order: 3;
    padding: 12px 12px 12px 0;
    gap: 12px;
    background: transparent;
  }

  .genz-comment {
    gap: 8px;
  }

  .genz-divider {
    order: 4;
    display: none; /* Hide divider on mobile */
  }

  .genz-footer {
    order: 5;
    padding: 12px 16px;
    background: transparent;
  }

  img.avatar {
    width: 28px;
    height: 28px;
    min-width: 28px;
    max-width: 28px;
    max-height: 28px;
  }

  .genz-header .username {
    font-size: 1rem;
  }

  .genz-comment .comment-text {
    font-size: 0.95rem;
  }

  .genz-footer .add-comment {
    font-size: 0.9rem;
  }

  .infinite-scroll-track.genz-track {
    padding: var(--container-padding-outer);
    padding-top: calc(var(--container-padding-outer) + 8vh);
  }
}

/* ================================
   Infinite Scroll Background
   ================================ */
.infinite-scroll-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  overflow: hidden;
  background: #000;
}

.infinite-scroll-track {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  will-change: transform;
  z-index: 1; /* Videos/images track - behind distance display */
}

/* Video track - scrolling background layer */
.infinite-scroll-track:not(.genz-track) {
  z-index: 1;
}

.infinite-scroll-track.genz-track {
  z-index: 100; /* Gen-Z track - in front of distance display */
  padding: var(--container-padding-outer);
  padding-top: calc(var(--container-padding-outer) + 10vh); /* Start content below fold */
}

.infinite-scroll-item {
  position: absolute;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  z-index: 1; /* Videos and regular images in the back */
}

/* Gen-Z items - override width for outer padding */
.infinite-scroll-item.genz-item {
  z-index: 100;
  width: calc(100% - var(--container-padding-outer) * 2) !important;
  left: var(--container-padding-outer);
}

/* Background videos - cover full viewport, no gaps */
.infinite-scroll-track:not(.genz-track) .infinite-scroll-item {
  height: 100vh;
  min-height: 100vh;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.infinite-scroll-track:not(.genz-track) .infinite-scroll-item video,
.infinite-scroll-track:not(.genz-track) .infinite-scroll-item img {
  width: 100%;
  height: 100%;
  min-height: 100vh;
  object-fit: cover;
  display: block;
}

/* Gen-z item media - fit within container */
.infinite-scroll-item.genz-item img,
.infinite-scroll-item.genz-item video {
  width: 100%;
  height: auto;
  display: block;
}

/* ================================
   Intro Sequence
   ================================ */

/* Fullscreen overlay - above everything */
.intro-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10001; /* Above milestone (10000) */
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: auto;
}

/* Each bubble - positioned absolutely for stacking */
.intro-bubble {
  /* Position variables */
  --offset-x: 0vw;
  --offset-y: 0vh;
  --final-rotation: 0deg;
  /* Animation variables (randomized per bubble) */
  --anim-duration: 0.6s;
  --bounce-scale: 1.2;
  --start-rotation: -25deg;
  --mid-rotation: 8deg;

  position: absolute;
  left: calc(50% + var(--offset-x));
  top: calc(50% + var(--offset-y));
  width: 80vmin;
  height: 80vmin;
  max-width: 600px;
  max-height: 600px;
  transform: translate(-50%, -50%) scale(0) rotate(var(--start-rotation));
  opacity: 0;
  pointer-events: none;
}

/* Bubble background image */
.intro-bubble-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
  position: absolute;
  top: 0;
  left: 0;
}

/* Smash-in animation - duration varies per bubble */
.intro-bubble.smashing {
  animation: intro-smash var(--anim-duration) cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* After smash, bubble stays visible - !important ensures it sticks */
.intro-bubble.visible {
  opacity: 1 !important;
  transform: translate(-50%, -50%) scale(1) rotate(var(--final-rotation)) !important;
  animation: none !important;
}

/* Exit: slide up as if swept by the scrolling feed */
.intro-bubble.exiting {
  animation: intro-sweep-up 0.6s ease-in forwards !important;
}

@keyframes intro-smash {
  0% {
    transform: translate(-50%, -50%) scale(0) rotate(var(--start-rotation));
    opacity: 0;
  }
  45% {
    transform: translate(-50%, -50%) scale(var(--bounce-scale)) rotate(var(--mid-rotation));
    opacity: 1;
  }
  65% {
    transform: translate(-50%, -50%) scale(0.92) rotate(calc(var(--final-rotation) - 5deg));
    opacity: 1;
  }
  80% {
    transform: translate(-50%, -50%) scale(1.04) rotate(calc(var(--final-rotation) + 2deg));
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(1) rotate(var(--final-rotation));
    opacity: 1;
  }
}

/* Swept up by the feed - slides up and out */
@keyframes intro-sweep-up {
  0% {
    transform: translate(-50%, -50%) translateY(0) scale(1) rotate(var(--final-rotation));
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) translateY(-120vh) scale(0.9) rotate(var(--final-rotation));
    opacity: 0;
  }
}

/* Bubble content - centered inside bubble */
.intro-bubble-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 70%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  z-index: 1;
}

/* Title text */
.intro-title {
  font-size: clamp(2.5rem, 10vmin, 5rem);
  font-weight: 900;
  color: #FFDD00;
  line-height: 1;
  text-transform: uppercase;
  letter-spacing: -2px;
  font-family: var(--font-bubble);
  /* Black outline */
  -webkit-text-stroke: 4px #000;
  paint-order: stroke fill;
}

/* Subtext */
.intro-subtext {
  font-size: clamp(0.9rem, 3vmin, 1.4rem);
  font-weight: 600;
  color: #FFDD00;
  line-height: 1.3;
  max-width: 90%;
  font-family: var(--font-bubble);
  /* Black outline */
  -webkit-text-stroke: 2px #000;
  paint-order: stroke fill;
}

/* Accept button */
.intro-accept-btn {
  margin-top: 16px;
  padding: 16px 32px;
  font-size: clamp(1rem, 2.5vmin, 1.3rem);
  font-weight: 700;
  text-transform: uppercase;
  background: #FFDD00;
  color: #000;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  pointer-events: auto;
  transition: transform 0.2s, background 0.2s;
  font-family: var(--font-bubble);
}

.intro-accept-btn:hover {
  transform: scale(1.05);
  background: #ffe433;
}

.intro-accept-btn:active {
  transform: scale(0.98);
}

/* Fade-out transition for entire overlay */
.intro-overlay.fading {
  animation: intro-fade-out 1s ease-out forwards;
  pointer-events: none;
}

@keyframes intro-fade-out {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

/* Mobile adjustments */
@media (max-width: 600px) {
  .intro-bubble {
    width: 90vmin;
    height: 90vmin;
  }

  .intro-bubble-content {
    width: 65%;
  }

  .intro-accept-btn {
    padding: 14px 24px;
  }
}
